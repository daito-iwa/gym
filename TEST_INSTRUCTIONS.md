# 認証システムテスト指示書

## 🔧 **セットアップ手順**

### 1. 環境準備
```bash
cd /Users/iwasakihiroto/Desktop/gym
```

### 2. Python バックエンドテスト
```bash
# 必要なパッケージをインストール
pip install pytest
pip install fastapi[all]
pip install python-multipart

# 認証システムテストを実行
python test_auth.py
```

### 3. Flutter フロントエンドテスト
```bash
# Flutterプロジェクトのクリーンアップ
flutter clean

# 依存関係の取得
flutter pub get

# テストの実行
flutter test test/auth_test.dart
```

### 4. iOS シミュレータでのテスト
```bash
# iOS シミュレータで起動
flutter run -d "iPhone 15 Pro"
```

## 📋 **テスト確認項目**

### ✅ **バックエンドテスト項目**
- [ ] ユーザー登録機能
- [ ] ログイン機能
- [ ] トークン生成・検証
- [ ] パスワードハッシュ化
- [ ] 認証が必要なエンドポイント保護
- [ ] エラーハンドリング

### ✅ **フロントエンドテスト項目**
- [ ] ログイン画面の表示
- [ ] サインアップ画面の切り替え
- [ ] 入力バリデーション
- [ ] フォーム送信機能
- [ ] ローディング状態の表示

### ✅ **統合テスト項目**
- [ ] アプリ起動時の認証チェック
- [ ] 自動ログイン機能
- [ ] ログアウト機能
- [ ] 認証後のメイン画面遷移
- [ ] 認証エラー時の処理

## 🚀 **動作確認手順**

### Step 1: バックエンド起動
```bash
cd /Users/iwasakihiroto/Desktop/gym
uvicorn api:app --reload --port 8000
```

### Step 2: iOS シミュレータ起動
```bash
# 新しいターミナルで実行
flutter run -d "iPhone 15 Pro"
```

### Step 3: 認証フローテスト
1. **アプリ起動**: ログイン画面が表示されることを確認
2. **新規登録**: 
   - "Create new account" をタップ
   - 必要情報を入力してサインアップ
   - 成功後、自動的にログイン
3. **ログイン**: 
   - 既存ユーザーでログイン
   - 認証成功後、メイン画面に遷移
4. **自動ログイン**: 
   - アプリを再起動
   - 自動的にログイン状態になることを確認
5. **ログアウト**: 
   - 右上のログアウトボタンをタップ
   - ログイン画面に戻ることを確認

## 🔍 **期待される動作**

### 正常動作
- ✅ ログイン画面が美しく表示される
- ✅ 入力バリデーションが適切に動作する
- ✅ 認証成功後、AIチャット画面に遷移する
- ✅ 自動ログイン機能が動作する
- ✅ ログアウト機能が動作する

### エラーハンドリング
- ✅ 無効な認証情報でのログイン時にエラーメッセージが表示される
- ✅ 重複するユーザー名でのサインアップ時にエラーが表示される
- ✅ ネットワークエラー時に適切なエラーメッセージが表示される

## 📱 **XCode でのテスト手順**

### 1. Xcodeを開く
```bash
open ios/Runner.xcworkspace
```

### 2. ビルド設定確認
- Target: Runner
- Scheme: Runner
- Destination: iOS Simulator (iPhone 15 Pro)

### 3. ビルドとテスト
- Command + B でビルド
- Command + R でシミュレータ起動
- 認証フローをテスト

## 🐛 **トラブルシューティング**

### コンパイルエラーが発生した場合
```bash
flutter clean
flutter pub get
```

### iOS シミュレータが起動しない場合
```bash
# iOS シミュレータをリスト表示
flutter devices

# 特定のデバイスを指定
flutter run -d [device-id]
```

### バックエンドに接続できない場合
- `lib/config.dart` のAPI URLを確認
- バックエンドが起動していることを確認
- ファイアウォール設定を確認

## ✅ **テスト完了チェックリスト**

### バックエンドテスト
- [ ] `python test_auth.py` が全て成功
- [ ] APIエンドポイントが正常動作
- [ ] セキュリティ設定が適切

### フロントエンドテスト
- [ ] `flutter test` が全て成功
- [ ] ウィジェットが正常表示
- [ ] バリデーションが適切動作

### 統合テスト
- [ ] Xcodeでのビルド成功
- [ ] iOS シミュレータでの起動成功
- [ ] 認証フローが完全動作
- [ ] エラーハンドリングが適切

## 📝 **テスト結果記録**

### バックエンドテスト結果
```
実行日時: _______________
結果: □ 成功 □ 失敗
エラー内容: _____________
```

### フロントエンドテスト結果
```
実行日時: _______________
結果: □ 成功 □ 失敗
エラー内容: _____________
```

### 統合テスト結果
```
実行日時: _______________
結果: □ 成功 □ 失敗
エラー内容: _____________
```

---

**🎉 全てのテストが成功すれば、認証システムは正常に動作しています！**