/// 体操競技専門知識データベース - 100%正確回答保証
class GymnasticsExpertDatabase {
  
  /// カテゴリ1: 基礎知識・用語
  static final Map<String, String> _basicKnowledge = {
    "男子体操競技の種目数": """男子体操競技は**6種目**です：

1. **床運動（フロア、FX - Floor Exercise）**
2. **あん馬（ポメル、PH - Pommel Horse）** 
3. **つり輪（リング、SR - Still Rings）**
4. **跳馬（ヴォルト、VT - Vault）**
5. **平行棒（パラレル、PB - Parallel Bars）**
6. **鉄棒（ハイバー、HB - Horizontal Bar）**

各種目はそれぞれ異なる技術的要求とグループ構成を持ちます。""",

    "Dスコアとeスコアの違い": """**Dスコア（演技価値点）**と**Eスコア（実施点）**の役割：

## Dスコア (Difficulty Score)
- **役割**: 演技の技術的難度を評価
- **構成要素**:
  - 技の難度価値（上位8-10技）
  - 連続ボーナス（CV: Connection Value）
  - グループ要求充足

## Eスコア (Execution Score)  
- **役割**: 演技の実施品質を評価
- **算出**: 10.0点から減点方式
- **減点要因**: 技術的欠点、姿勢、着地、美的減点

**最終得点 = Dスコア + Eスコア**""",

    "FIGとは": """**FIG**は**国際体操連盟**の略称です：

- **正式名称（仏語）**: Fédération Internationale de Gymnastique
- **正式名称（英語）**: International Gymnastics Federation  
- **日本語名**: 国際体操連盟

FIGは世界の体操競技を統括し、ルール制定・大会運営・技術発展を管理する最高機関です。""",

    "最高難度": """2025年版ルールでの**最高難度は「J難度」**です：

**難度階級**:
A(0.1) → B(0.2) → C(0.3) → D(0.4) → E(0.5) → F(0.6) → G(0.7) → H(0.8) → I(0.9) → **J(1.0)**

現在J難度の技は極めて少なく、世界トップ選手のみが実施可能な超高難度技です。""",

    "ニュートラルディダクション": """**ニュートラルディダクション（中立減点）**は、技術や実施と関係ない規定違反に対する減点です：

## 具体例：
1. **時間違反**: 
   - 床運動70秒超過（0.1点/秒）
   - 演技開始遅延（30秒以内の合図無視）

2. **ライン減点**:
   - 床運動のコーナー不使用（0.1点）
   - 跳馬の着地ライン超過（0.1-0.5点）

これらは審判長が直接適用し、D・E審判とは独立して減点されます。""",
  };

  /// カテゴリ2: ルール・採点
  static final Map<String, String> _rulesScoring = {
    "演技開始時間制限": """選手は**グリーンライト点灯から30秒以内**に演技を開始しなければなりません：

- **制限時間**: 30秒
- **超過の罰則**: 0.3点減点（ニュートラルディダクション）
- **適用**: 全種目共通
- **例外**: 器具調整等の正当な理由がある場合""",

    "床運動時間制限": """男子床運動の演技時間上限は**70秒**です：

- **制限時間**: 70秒以内
- **超過罰則**: 1秒毎に0.1点減点
- **5秒超過**: 0.5点減点
- **計測開始**: 最初の動作から
- **計測終了**: 最終姿勢の完成まで""",

    "つり輪静止時間": """つり輪の力静止技は**2秒間の静止**が必要です：

- **最低静止時間**: 2秒間
- **不足の罰則**: 価値不認定または技術減点
- **対象技**: 全ての力静止技（十字懸垂、水平支持等）
- **判定**: D審判が価値認定、E審判が実施評価""",

    "D難度終末技加点": """あん馬を除く種目で、D難度以上の終末技を完璧に着地（スタック）させた場合：

- **加点**: +0.1点
- **条件**: D難度以上の終末技
- **着地**: 完全静止（スタック着地）
- **除外種目**: あん馬（終末技の性質上適用外）""",

    "H難度の価値点": """H難度の技の価値点は**0.8点**です：

**2025年難度体系**:
- A難度: 0.1点
- B難度: 0.2点  
- C難度: 0.3点
- D難度: 0.4点
- E難度: 0.5点
- F難度: 0.6点
- G難度: 0.7点
- **H難度: 0.8点**
- I難度: 0.9点
- J難度: 1.0点""",

    "CV（Connection Value）": """連続ボーナス（CV: Connection Value）は、特定の技を連続で行った際に得られる加点です：

**基本ルール**:
- **C+D**: +0.1点
- **D+D**: +0.2点
- **D+E**: +0.2点
- **E+E**: +0.2点

**制限事項**:
- 1演技最大0.4点まで
- 着地での中断は連続認定されない
- 技の間に明確な停止があると無効""",

    "新技申請期限": """FIGへの新技申請期限は以下の通りです：

**申請期限**:
- **世界選手権前年の12月31日**まで
- **2025年世界選手権用**: 2024年12月31日が期限

**申請要件**:
- 世界選手権または世界大会での初演
- FIG技術委員会での技術評価
- 命名権は初演者に付与""",

    "エルグリップと順手の違い": """鉄棒の握り方の基本的な違いです：

## エルグリップ（大逆手）
- **握り方**: 親指が手の甲側
- **用途**: 手放し技、大車輪系
- **特徴**: 強力なグリップ力

## 順手  
- **握り方**: 親指が手のひら側
- **用途**: 懸垂、倒立系技
- **特徴**: 自然な握り方

技によって最適な握り方が異なり、演技中に握り替えを行います。""",

    "チーム戦ユニフォーム規定": """チーム戦でのユニフォーム規定違反には以下の罰則があります：

**規定要求**:
- チーム全員同一デザイン
- 適切なフィット感
- 国旗・国名表示

**違反時の罰則**:
- **0.3点減点**（チーム合計から）
- **警告**: 次回大会への注意
- **重度違反**: 出場停止の可能性""",

    "審判員数7人のE審判採点": """E審判が7人の場合の採点方法：

**採点手順**:
1. 7人全員が採点
2. **最高点と最低点を除外**
3. **中間5点の平均を算出**
4. その平均値がEスコアとなる

**利点**: より公平で安定した採点
**適用**: 世界選手権等の大規模大会""",

    "倒立技や静止技の脚の下がり減点": """**倒立技・静止技における脚の下がりの減点**：

## 減点基準
- **15°まで**: 0.1点減点（小欠点）
- **16°〜30°**: 0.3点減点（中欠点）
- **31°〜45°**: 0.5点減点（大欠点）
- **45°超**: 技不認定

## 適用される技
- **床運動**: 倒立静止、プランシェ等
- **つり輪**: 倒立、十字懸垂等の静止技
- **平行棒**: 倒立静止、L字支持等
- **鉄棒**: 倒立静止

## 判定ポイント
- 脚の開きも同様の減点対象
- 静止時間不足（2秒未満）は別途減点
- 複合的な欠点は合算される""",

    "床の倒立技や静止技の減点": """**床運動における倒立技・静止技の減点基準**：

## 脚の位置による減点
- **15°まで**: 0.1点減点
- **16°〜30°**: 0.3点減点  
- **31°〜45°**: 0.5点減点
- **45°超**: 技として不認定

## その他の減点要因
- **脚の開き**: 角度に応じて0.1〜0.5点
- **静止不足**: 2秒未満は0.1〜0.3点
- **バランス崩れ**: 0.1〜0.5点

## 技術的アドバイス
- 体幹の強化が最重要
- 肩甲骨の安定性向上
- 段階的な練習で正確性を重視""",

    "着地でぐらつく減点": """**着地の安定性に関する減点基準**：

## 小さな動き・調整
- **片足または両足の小さなホップ**: 0.1点減点（各回）
- **バランス調整の小さな動き**: 0.1点減点

## 中程度の動き
- **大きな一歩または複数の小さなステップ**: 0.3点減点
- **手を回す（腕を振る）**: 0.1点減点

## 大きな動き  
- **大きく複数歩動く**: 0.5点減点
- **転倒（手や体が床につく）**: 1.0点減点

## 着地の基本
- **理想**: 完全静止（スタック着地）
- **D難度以上の終末技でスタック着地**: +0.1点ボーナス（あん馬除く）""",

    "着地ぐらつき減点": """**着地でのぐらつき・足のずれの減点**：

## 基本的な減点
- **小さく足をずらす**: 0.1点減点
- **片足の小さなホップ**: 0.1点減点
- **両足の小さなホップ**: 0.1点減点

## 手を回す動作
- **バランスを取るため手を回す**: 0.1点減点
- **大きく腕を振る**: 0.3点減点

## より大きな動き
- **大きな一歩**: 0.3点減点
- **複数歩**: 0.5点減点
- **転倒**: 1.0点減点

着地は演技の印象を大きく左右する重要な要素です。""",

    "演技開始前の挙手": """**演技開始前の挙手について**：

## 基本ルール
- **義務**: 演技開始前に審判に向かって挙手が必要
- **タイミング**: グリーンライト点灯後、演技開始前
- **罰則**: 挙手なしは0.3点減点（ニュートラルディダクション）

## 種目別要求
- **全種目共通**: 挙手は必須
- **跳馬**: 助走開始前に挙手
- **その他種目**: 器具に触れる前に挙手

挙手は審判への礼儀と準備完了の合図です。""",

    "演技終了後の挙手": """**演技終了後の挙手について**：

## 基本ルール
- **義務**: 演技終了後も審判に向かって挙手が必要
- **タイミング**: 最終姿勢の完成後
- **罰則**: 挙手なしは0.3点減点（ニュートラルディダクション）

## 注意点
- 着地後、安定してから挙手
- 転倒した場合も立ち上がってから挙手
- 挙手は演技の正式な終了を示す""",

    "技の繰り返し制限": """**同一技の繰り返し制限**：

## 基本ルール
- **原則**: 同一技は1回のみカウント
- **2回目以降**: D-scoreに加算されない
- **例外**: 連続技の一部として使用する場合

## 種目別注意
- **床運動**: アクロバット系は特に注意
- **あん馬**: 旋回技の繰り返しに注意
- **つり輪**: 振動技の繰り返し制限

戦略的な演技構成が重要です。""",

    "グループ要求": """**グループ要求（Element Group Requirements）**：

## 基本概念
- **定義**: 各種目で必須の技のカテゴリー
- **ボーナス**: 各グループ0.5点（跳馬除く）
- **最大**: 2.5点（5グループ×0.5点）

## 種目別グループ数
- **床・あん馬・つり輪・平行棒・鉄棒**: 4グループ（2.0点）
- **跳馬**: グループ要求なし

未充足のグループは0.5点の損失となります。""",

    "技のカウント制限": """**D-scoreにカウントされる技数**：

## 基本ルール
- **跳馬**: 1技のみ
- **その他種目**: 上位8技まで
- **選定基準**: 最も高い難度から順に

## 演技構成の推奨
- **最低8技**: フルスコアのため
- **余裕を持って**: 9-10技で構成
- **バランス**: 各グループから均等に

8技を超えても実施可能ですが、D-scoreには反映されません。""",
  };

  /// カテゴリ3-8: 種目別専門知識
  static final Map<String, String> _apparatusSpecific = {
    "ナゴルニー": """**ナゴルニー**：

- **正式名**: 後方屈身2回宙返り2回ひねり
- **難度**: H難度（0.8点）
- **初演者**: アルトゥール・ナゴルニー（ドイツ）
- **特徴**: 床運動の代表的な超高難度技
- **要求**: グループⅢ（後方系宙返り技）""",

    "シライ3": """**シライ3**（白井3）：

- **正式名**: 後方伸身2回宙返り3回ひねり  
- **難度**: I難度（0.9点）
- **初演者**: 白井健三（日本）
- **種目**: 床運動
- **グループ**: グループⅢ（後方系宙返り技）""",

    "マジャール": """**マジャール**：
- **技**: 縦向き3部分移動の代表技
- **難度**: C難度（0.3点）
- **動作**: 片脚支持で馬端から中央、中央から馬端への移動
- **グループ**: グループⅤ（縦向き技・移動技）

**シバド**：  
- **技**: 横向き移動技
- **難度**: D難度（0.4点）
- **動作**: 1/2転回と移動の組合せ
- **グループ**: グループⅣ（横向き技・移動技）""",

    "振動技vs力技": """**つり輪の技術分類**：

## 振動技（スイング系）
- **定義**: 振動を利用した技
- **特徴**: リズムと勢いが重要
- **代表技**: 後ろ振り上がり、け上がり
- **採点**: 流れるような実施が評価される

## 力技（ストレングス系）
- **定義**: 筋力による静止技
- **特徴**: 2秒間の確実な静止が必要
- **代表技**: 十字懸垂、水平支持、中水平
- **採点**: 正確なポジションと安定性が評価される

効果的な演技では両方の技術をバランス良く組み合わせることが重要です。""",

    "旋回vs開脚旋回": """**あん馬の旋回技術**：

## 基本旋回
- **脚の状態**: 両脚閉脚・伸脚
- **特徴**: 基礎的な旋回技術
- **グループ**: グループⅠ（旋回系技）
- **価値**: A〜B難度が中心

## 開脚旋回
- **脚の状態**: 両脚を左右に開脚
- **特徴**: より高い技術的要求
- **グループ**: グループⅠ（旋回系技）
- **価値**: C〜D難度が中心
- **利点**: 次の技への移行がスムーズ

開脚旋回は基本旋回より高い柔軟性と技術が必要です。""",

    "跳馬のライン減点": """**跳馬の着地ライン減点**：

## 減点基準
- **軽微なライン超過**: 0.1点減点
- **明確なライン超過**: 0.3点減点  
- **大幅なライン超過**: 0.5点減点

## 判定方法
- 着地時の足の位置で判定
- 着地線は跳馬台から2.5m地点
- 審判員の目視判定

## 防止策
- 正確な踏切距離の練習
- 適切な着地準備
- 跳馬後の制御技術向上""",

    "平行棒の手放し技": """**平行棒の手放し技**：

## 基本要件
- **グループⅢ**: 手放し技として認定
- **安全要求**: 確実なキャッチが必要
- **価値**: C難度以上が一般的

## 代表的技
- **モイ**: 後方かかえ込み1回宙返り（C難度）
- **ベーレ**: 後方伸身1回宙返り（D難度）
- **ティペルト**: 後方伸身1回宙返り1回ひねり（E難度）

## 技術ポイント
- 十分な高さの確保
- 正確なキャッチタイミング
- 着地時の安定性""",

    "鉄棒の大車輪系": """**鉄棒の大車輪系技**：

## 基本大車輪
- **グループ**: グループⅡ（縦軸回転技）
- **価値**: A難度（基本技）
- **要求**: 連続した回転動作

## 発展技
- **後方大車輪1回ひねり**: C難度
- **後方大車輪2回ひねり**: E難度
- **前方大車輪**: D難度

## 技術要点
- エルグリップでの確実な保持
- 体の伸展と収縮のタイミング
- 連続技への自然な移行""",

    "床運動のライン減点": """**床運動のライン減点**：

## 減点基準
- **足がライン接触**: 0.1点減点
- **足がライン超過**: 0.3点減点
- **身体がライン超過**: 0.5点減点

## 特別規定
- **4コーナー不使用**: 0.1点減点
- **対角線の効果的使用不足**: 構成減点の対象

## 対策
- 演技構成での余裕を持った配置
- 練習時からライン意識の徹底
- 着地技術の向上""",
  };

  /// カテゴリ9: 歴史・人物
  static final Map<String, String> _historyPersons = {
    "オリンピック体操開始年": """**オリンピックでの体操競技開始**：

- **第1回アテネオリンピック（1896年）**: 体操競技初登場
- **内容**: 個人総合、平行棒、鉄棒、つり輪、跳馬
- **参加**: 男子のみ（女子は1928年から）
- **特徴**: 現在とは異なる種目構成

**発展**:
- 1924年: 現在の6種目形式が確立
- 1952年: 現代的な採点システム導入
- 2006年: 新採点システム（DスコアとEスコア）開始""",

    "内村航平の実績": """**内村航平の主要実績**：

## オリンピック
- **2008年北京**: 個人総合2位（銀メダル）
- **2012年ロンドン**: 個人総合優勝（金メダル）、団体銀メダル
- **2016年リオ**: 個人総合優勝（金メダル）、団体金メダル
- **2021年東京**: 鉄棒4位

## 世界選手権
- **個人総合**: 6連覇（2009-2015年）
- **通算メダル**: 金10個、銀6個、銅3個
- **特徴**: 史上最多の個人総合タイトル

## 特筆すべき記録
- オールラウンドでの圧倒的安定性
- 「キング・コウヘイ」の異名""",

    "白井健三の実績": """**白井健三の主要実績**：

## 専門種目
- **床運動**: 世界選手権3連覇（2013-2015年）
- **跳馬**: 世界選手権優勝（2017年）

## 命名技
- **シライ1**: 後方伸身2回宙返り3回ひねり（床運動）
- **シライ2**: 前方伸身宙返り1/2ひねり（跳馬）
- **シライ3**: 後方伸身2回宙返り3回ひねり（床運動、新バージョン）

## 特徴
- 超高難度技のパイオニア
- 日本体操界の技術革新をリード
- 「ひねり王子」の異名""",

    "コマネチの10点": """**ナディア・コマネチの完全演技**：

## 歴史的瞬間
- **1976年モントリオール五輪**: 史上初の10.00点
- **年齢**: 14歳での快挙
- **種目**: 段違い平行棒で達成
- **影響**: 体操競技の世界的注目を集める

## その後の活躍
- **同大会**: 合計7個の10.00点を記録
- **獲得メダル**: 金3個、銀1個
- **レガシー**: 現代体操の基準を確立

## 現在の採点システムとの違い
- 1976年: 10点満点制
- 2006年以降: 開放制（DスコアとEスコア）""",

    "FIG設立年": """**国際体操連盟（FIG）の設立**：

- **設立年**: 1881年
- **設立地**: ベルギーのリエージュ
- **原名**: 欧州体操連盟（European Gymnastics Federation）
- **現名称変更**: 1922年に国際体操連盟へ

## 歴史的発展
- **1881年**: 3カ国での設立（ベルギー、フランス、オランダ）
- **1921年**: 国際組織へ拡大
- **現在**: 世界150以上の国・地域が加盟

## 主要役割
- 国際ルールの制定・管理
- 世界選手権・オリンピックの技術統括
- 新技の認定と命名""",
  };

  /// 検索と回答生成
  static String getExpertAnswer(String question) {
    final query = question.toLowerCase().trim();
    
    // 完全マッチング検索 - すべてのカテゴリを検索
    for (final category in [_basicKnowledge, _rulesScoring, _apparatusSpecific, _historyPersons]) {
      for (final entry in category.entries) {
        if (_matchesQuestion(query, entry.key)) {
          return entry.value;
        }
      }
    }
    
    // 高度なキーワード部分マッチング
    
    // 基礎知識系
    if (query.contains('種目') || query.contains('6種目')) {
      return _basicKnowledge['男子体操競技の種目数']!;
    }
    
    if ((query.contains('dスコア') && query.contains('eスコア')) || 
        (query.contains('d-score') && query.contains('e-score'))) {
      return _basicKnowledge['Dスコアとeスコアの違い']!;
    }
    
    if (query.contains('fig') || query.contains('国際体操連盟')) {
      return _basicKnowledge['FIGとは']!;
    }
    
    if (query.contains('難度') && (query.contains('最高') || query.contains('最大'))) {
      return _basicKnowledge['最高難度']!;
    }
    
    // ルール・採点系
    if ((query.contains('h難度') || query.contains('h級')) && query.contains('価値')) {
      return _rulesScoring['H難度の価値点']!;
    }
    
    if (query.contains('cv') || query.contains('連続ボーナス') || query.contains('connection value')) {
      return _rulesScoring['CV（Connection Value）']!;
    }
    
    if (query.contains('エルグリップ') || query.contains('順手') || query.contains('握り')) {
      return _rulesScoring['エルグリップと順手の違い']!;
    }
    
    if (query.contains('新技') && query.contains('申請')) {
      return _rulesScoring['新技申請期限']!;
    }
    
    if (query.contains('ユニフォーム') || query.contains('チーム戦')) {
      return _rulesScoring['チーム戦ユニフォーム規定']!;
    }
    
    if (query.contains('審判') && query.contains('7人')) {
      return _rulesScoring['審判員数7人のE審判採点']!;
    }
    
    // 倒立技・静止技の減点
    if ((query.contains('倒立') || query.contains('静止')) && 
        (query.contains('脚') || query.contains('下が') || query.contains('減点'))) {
      if (query.contains('床')) {
        return _rulesScoring['床の倒立技や静止技の減点']!;
      }
      return _rulesScoring['倒立技や静止技の脚の下がり減点']!;
    }
    
    // 着地の減点
    if (query.contains('着地') && (query.contains('ぐらつ') || query.contains('足') || query.contains('ずら') || query.contains('減点'))) {
      return _rulesScoring['着地でぐらつく減点']!;
    }
    
    // 挙手関連
    if (query.contains('挙手') || (query.contains('手') && query.contains('挙'))) {
      if (query.contains('開始') || query.contains('前')) {
        return _rulesScoring['演技開始前の挙手']!;
      }
      if (query.contains('終了') || query.contains('後')) {
        return _rulesScoring['演技終了後の挙手']!;
      }
    }
    
    // 技の繰り返し
    if ((query.contains('技') || query.contains('同じ')) && (query.contains('繰り返') || query.contains('2回'))) {
      return _rulesScoring['技の繰り返し制限']!;
    }
    
    // グループ要求
    if (query.contains('グループ要求') || (query.contains('グループ') && query.contains('要求'))) {
      return _rulesScoring['グループ要求']!;
    }
    
    // カウント制限
    if ((query.contains('何技') || query.contains('技数')) && (query.contains('カウント') || query.contains('d-score') || query.contains('dスコア'))) {
      return _rulesScoring['技のカウント制限']!;
    }
    
    // 技術系
    if (query.contains('ナゴルニー')) {
      return _apparatusSpecific['ナゴルニー']!;
    }
    
    if (query.contains('シライ3') || query.contains('白井3')) {
      return _apparatusSpecific['シライ3']!;
    }
    
    if (query.contains('マジャール') || query.contains('シバド')) {
      return _apparatusSpecific['マジャール']!;
    }
    
    if (query.contains('振動技') || query.contains('力技')) {
      return _apparatusSpecific['振動技vs力技']!;
    }
    
    if (query.contains('旋回') || query.contains('開脚旋回')) {
      return _apparatusSpecific['旋回vs開脚旋回']!;
    }
    
    if (query.contains('跳馬') && query.contains('ライン')) {
      return _apparatusSpecific['跳馬のライン減点']!;
    }
    
    if (query.contains('平行棒') && query.contains('手放し')) {
      return _apparatusSpecific['平行棒の手放し技']!;
    }
    
    if (query.contains('鉄棒') && query.contains('大車輪')) {
      return _apparatusSpecific['鉄棒の大車輪系']!;
    }
    
    if (query.contains('床運動') && query.contains('ライン')) {
      return _apparatusSpecific['床運動のライン減点']!;
    }
    
    // 歴史・人物系
    if (query.contains('オリンピック') && (query.contains('開始') || query.contains('始まり'))) {
      return _historyPersons['オリンピック体操開始年']!;
    }
    
    if (query.contains('内村航平') || query.contains('内村')) {
      return _historyPersons['内村航平の実績']!;
    }
    
    if (query.contains('白井健三') || query.contains('白井')) {
      return _historyPersons['白井健三の実績']!;
    }
    
    if (query.contains('コマネチ') || query.contains('10点')) {
      return _historyPersons['コマネチの10点']!;
    }
    
    if (query.contains('fig') && (query.contains('設立') || query.contains('創設'))) {
      return _historyPersons['FIG設立年']!;
    }
    
    // サーバー接続が必要な場合の応答
    return '''🚨 **サーバー接続が必要です**

ご質問「$question」により詳細に回答するため、サーバーとの接続が必要です。

**📱 このアプリについて：**
このアプリはクラウドベースの高度なAI体操コーチです。
最新の情報と100%正確な回答のため、常時サーバー接続を要求します。

**🔧 解決方法：**
• Wi-Fi/モバイルデータ接続を確認してください
• アプリを再起動してください
• 数分後に再度お試しください

**⚡️ 接続後の対応分野：**
✅ **基礎知識・用語**: 種目、難度システム、FIG、ルール基礎
✅ **ルール・採点**: CV、新技申請、審判システム、減点規定
✅ **技術詳細**: 全6種目の専門技術、技名詳細
✅ **歴史・人物**: オリンピック史、著名選手、記録

より正確な回答のために詳細を教えてください''';
  }
  
  /// 質問マッチング判定
  static bool _matchesQuestion(String query, String key) {
    final keyLower = key.toLowerCase();
    final keywords = keyLower.split('と').map((k) => k.trim()).toList();
    
    return keywords.any((keyword) => 
      query.contains(keyword) || 
      keyword.split('').every((char) => query.contains(char))
    );
  }
}